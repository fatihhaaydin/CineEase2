@model PaymentViewModel

<h2 id="pageTitle"></h2>
<h2 style="display: inline-block;">Payment</h2>
<h4 id="paymentTitle" style="display: inline-block;"></h4>
<h3 style="display: inline-block; margin-left: 530px;">Ödeme Bilgileri</h3>

<div style="display: flex;">
    <div style="flex: 1; margin-right: 10px;">
        <table class="table table-bordered" style="border-color:black">
            <tbody>
                <tr>
                    <th>Fiyat:</th>
                    <td><span id="priceLabel">@Model.Ticket.price.ToString("C")</span></td>
                </tr>
                <tr>
                    <th>İndirim Türü:</th>
                    <td>
                        <select id="discountDropdown" asp-for="Ticket.discount" asp-items="ViewBag.DiscountTypes" style="background-color:darkcyan">
                            <option value="">Seçiniz</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <th>İndirim Bilgisi:</th>
                    <td><div id="discountInfo" style="margin-top: 5px;"></div></td>
                </tr>
                <tr>
                    <th>Net Fiyat:</th>
                    <td><span id="netPriceLabel">@Model.Ticket.price.ToString("C")</span></td>
                </tr>
            </tbody>
        </table>
    </div>

    <div style="flex: 1;">
        <form id="paymentForm" asp-action="ProcessPayment" method="post">
            <table class="table table-bordered" style="border-color:black">
                <tbody>
                    <tr>
                        <th>Kredi Kartı Numarası:</th>
                        <td>
                            <input class="card-segment" type="text" maxlength="4" placeholder="xxxx" /> -
                            <input class="card-segment" type="text" maxlength="4" placeholder="xxxx" /> -
                            <input class="card-segment" type="text" maxlength="4" placeholder="xxxx" /> -
                            <input class="card-segment" type="text" maxlength="4" placeholder="xxxx" />
                        </td>
                    </tr>
                    <tr>
                        <th>Son Kullanma Tarihi:</th>
                        <td>
                            <input class="card-segment" type="text" maxlength="2" placeholder="mm" /> /
                            <input class="card-segment" type="text" maxlength="2" placeholder="yy" />
                        </td>
                    </tr>
                    <tr>
                        <th>CVV:</th>
                        <td>
                            <input class="card-segment" type="text" maxlength="3" placeholder="" />
                        </td>
                    </tr>
                </tbody>
            </table>
            <button type="submit" style="margin-left: 530px;background-color:black;color:white;">Ödeme Yap</button>
        </form>
    </div>
</div>

<div id="message" style="margin-top: 20px; font-size: 1.2em;"></div>

@section Scripts {
    <script>
        document.getElementById("discountDropdown").addEventListener("change", function () {
            var selectedDiscount = this.value;
            var discountInfo = document.getElementById("discountInfo");
            var netPriceLabel = document.getElementById("netPriceLabel");
            var price = parseFloat('@Model.Ticket.price');

            if (selectedDiscount === "Student") {
                discountInfo.innerHTML = "<p>Öğrenci indirimi: %20</p>";
                netPriceLabel.textContent = (price * 0.8).toFixed(2);
            } else if (selectedDiscount === "Senior") {
                discountInfo.innerHTML = "<p>65 yaş üstü indirimi: %15</p>";
                netPriceLabel.textContent = (price * 0.85).toFixed(2);
            } else if (selectedDiscount === "Küçük") {
                discountInfo.innerHTML = "<p>7 yaş altı indirimi: %35</p>";
                netPriceLabel.textContent = (price * 0.65).toFixed(2);
            } else if (selectedDiscount === "Yetişkin") {
                discountInfo.innerHTML = "<p>Yetişkin indirimi: 0</p>";
                netPriceLabel.textContent = (price).toFixed(2);
            } else {
                discountInfo.innerHTML = "";
                netPriceLabel.textContent = price.toFixed(2);
            }
        });

        document.querySelectorAll('.card-segment').forEach(function (input) {
            input.addEventListener('input', function () {
                if (input.value.length > 0) {
                    input.placeholder = '';
                } else {
                    input.placeholder = 'xxxx';
                }
            });
        });

        document.getElementById("paymentForm").addEventListener("submit", function (event) {
            event.preventDefault();

            var discountDropdown = document.getElementById("discountDropdown");
            var cardSegments = document.querySelectorAll('.card-segment');
            var emptyCardFields = Array.from(cardSegments).some(function (input) {
                return input.value.trim() === "";
            });

            if (discountDropdown.value === "") {
                alert("Lütfen indirim türünü seçiniz.");
            } else if (emptyCardFields) {
                alert("Lütfen kredi kartı bilgilerini eksiksiz giriniz.");
            } else {
                // AJAX ile form gönderimi
                var formData = new FormData(document.getElementById("paymentForm"));
                fetch('@Url.Action("ProcessPayment")', {
                    method: 'POST',
                    body: formData,
                })
                    .then(response => response.json())
                    .then(data => {
                        var messageDiv = document.getElementById("message");
                        if (data.success) {
                            messageDiv.style.color = "green";
                            messageDiv.textContent = data.message;
                        } else {
                            messageDiv.style.color = "red";
                            messageDiv.textContent = data.message;
                        }
                    })
                    .catch(error => console.error('Error:', error));
            }
        });
    </script>
}

<style>
    .card-segment {
        width: 50px;
        text-align: left;
        margin-right: 5px;
        display: inline-block;
    }
</style>






