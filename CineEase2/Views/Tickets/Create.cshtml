@model CineEase2.Models.Ticket

@{
    ViewData["Title"] = "Create";
}

<h2 id="pageTitle"></h2>
<h2 style="display: inline-block;">Ödeme</h2>
<hr />
<div class="row">
    <div class="col-md-8">
        <form asp-action="Create" method="post">
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>
            <table class="table table-bordered" style="border-color:black">
                <tbody>
                    <tr>
                        <td><label asp-for="price" class="control-label" style="font-weight:bold">Fiyat</label></td>
                        <td><input asp-for="price" class="form-control" readonly value="50.0" style="background-color:black;color:white;" /></td>
                        <td><span asp-validation-for="price" class="text-danger"></span></td>
                    </tr>
                    <tr>
                        <td><label asp-for="discount" class="control-label" style="font-weight:bold">İndirim</label></td>
                        <td>
                            <select asp-for="discount" class="form-control" style="background-color:black;color:white;">
                                <option value="">Seçiniz</option>
                                <option value="Öğrenci">Öğrenci</option>
                                <option value="65 yaş üstü">65 yaş üstü</option>
                                <option value="7 yaş altı">7 yaş altı</option>
                                <option value="Yetişkin">Yetişkin</option>
                            </select>
                        </td>
                        <td></td>
                    </tr>
                    <tr>
                        <td></td>
                        <td colspan="2" id="discountMessageContainer"></td>
                    </tr>
                    <tr>
                        <td><label asp-for="netprice" class="control-label" style="font-weight:bold">Net Fiyat</label></td>
                        <td><input id="netprice" asp-for="netprice" class="form-control" readonly style="background-color:black;color:white;" /></td>
                        <td><span asp-validation-for="netprice" class="text-danger"></span></td>
                    </tr>
                    <tr>
                        <td><label asp-for="SeatNumber" class="control-label" style="font-weight:bold">Koltuk Seçimi</label></td>
                        <td>
                            <div id="seat-selection" class="d-flex flex-wrap">
                                @for (int seat = 1; seat <= 68; seat++)
                                {
                                    <div class="seat" data-seat="@seat" style="width: 30px; height: 30px; margin: 5px; border: 1px solid black; display: inline-block; cursor: pointer; text-align: center; line-height: 30px;">
                                        @seat
                                    </div>
                                }
                            </div>
                            <input id="selectedSeat" asp-for="SeatNumber" type="hidden" />
                        </td>
                        <td><span asp-validation-for="SeatNumber" class="text-danger"></span></td>
                    </tr>
                    <tr>
                        <td><label asp-for="CreditCardNumber" class="control-label" style="font-weight:bold">Kredi Kartı Numarası</label></td>
                        <td><input asp-for="CreditCardNumber" class="form-control" maxlength="16" style="background-color:black;color:white;" /></td>
                        <td><span asp-validation-for="CreditCardNumber" class="text-danger"></span></td>
                    </tr>
                    <tr>
                        <td><label asp-for="ExpirationDate" class="control-label" style="font-weight:bold">Son Kullanma Tarihi</label></td>
                        <td><input asp-for="ExpirationDate" class="form-control" maxlength="5" style="background-color:black;color:white;" /></td>
                        <td><span asp-validation-for="ExpirationDate" class="text-danger"></span></td>
                    </tr>
                    <tr>
                        <td><label asp-for="CVV" class="control-label" style="font-weight:bold">CVV</label></td>
                        <td><input asp-for="CVV" class="form-control" maxlength="3" style="background-color:black;color:white;" /></td>
                        <td><span asp-validation-for="CVV" class="text-danger"></span></td>
                    </tr>
                    <tr>
                        <td></td>
                        <td><input type="submit" value="Ödeme Yap" style="background-color:black;color:white;" /></td>
                        <td></td>
                    </tr>
                </tbody>
            </table>
        </form>
    </div>
</div>

@section Scripts {
    <script>
        document.getElementById("discount").addEventListener("change", function () {
            var selectedDiscount = this.value;
            var price = 50.0;

            var netPrice;
            var discountMessage;
            if (selectedDiscount === "Öğrenci") {
                netPrice = price * 0.8;
                discountMessage = "Öğrenci indirimi: %20";
            } else if (selectedDiscount === "65 yaş üstü") {
                netPrice = price * 0.85;
                discountMessage = "65 yaş üstü indirimi: %15";
            } else if (selectedDiscount === "7 yaş altı") {
                netPrice = price * 0.65;
                discountMessage = "7 yaş altı indirimi: %35";
            } else if (selectedDiscount === "Yetişkin") {
                netPrice = price;
                discountMessage = "Yetişkin fiyatı: %100";
            } else {
                netPrice = price;
                discountMessage = "";
            }
            document.getElementById("netprice").value = netPrice.toFixed(2);
            var discountMessageContainer = document.getElementById("discountMessageContainer");
            discountMessageContainer.innerHTML = "<div class='alert alert-info'>" + discountMessage + "</div>";
        });

        document.getElementById("CVV").addEventListener("input", function () {
            this.value = this.value.replace(/\D/g, '');
            if (this.value.length > 3) {
                this.value = this.value.slice(0, 3);
            }
        });

        document.getElementById("ExpirationDate").addEventListener("input", function () {
            var input = this.value.replace(/\D/g, ''); // Sadece sayıları kabul et
            if (input.length > 5) {
                input = input.slice(0, 5); // Maksimum 5 karakter olacak şekilde sınırla
            }
            if (input.length > 2) {
                input = input.slice(0, 2) + '/' + input.slice(2); // mm/yy formatını sağla
            }
            this.value = input;
        });

        // Seat selection
        document.querySelectorAll('.seat').forEach(function (seat) {
            seat.addEventListener('click', function () {
                document.querySelectorAll('.seat').forEach(function (s) {
                    s.style.backgroundColor = 'white';
                });
                this.style.backgroundColor = 'blue';
                document.getElementById('selectedSeat').value = this.getAttribute('data-seat');
            });
        });
    </script>

}









